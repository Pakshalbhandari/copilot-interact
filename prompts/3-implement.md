Now, implement the most critical refactoring suggestions from above.
Provide the improved code with explanations of changes made.